<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search - Sehatra</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-[#f5f5f5] font-poppins font-normal">

    <!-- Search Header -->
    <div class="flex items-center justify-between p-5 bg-white shadow">

        <!-- SEARCH BOX CONTAINER -->
        <div class="w-full max-w-4xl relative">

            <!-- INPUT ROW -->
            <div class="flex items-center gap-3 border px-4 py-2 rounded-xl bg-white">
                <lord-icon src="https://cdn.lordicon.com/wjyqkiew.json" trigger="hover" colors="primary:#2d5143"
                    style="width:25px;height:25px">
                </lord-icon>

                <input id="searchInput" type="text" placeholder="Search"
                    class="w-full bg-transparent outline-none text-lg">
            </div>

            <!-- SUGGESTIONS DROPDOWN (WORKING) -->
            <div id="suggestions" class="absolute left-0 right-0 bg-white shadow-xl rounded-xl mt-1 hidden z-50">
            </div>

        </div>

        <!-- CLOSE BUTTON -->
        <button onclick="window.location.href='/'" class="ml-5 text-lg font-semibold text-gray-600 hover:text-black">
            Close
        </button>

    </div>



    <!-- Products Section -->
    <div class="p-10">
        <h2 class="text-2xl font-poppins font-bold mb-6">Products</h2>

        <div id="productList" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-10">

            {% for p in products %}
            <a href="/product/{{ p.id }}">
                <div class="p-3 rounded-xl hover:shadow-xl transition cursor-pointer bg-white">
                    <img loading="lazy" src="{{ p.image_url }}" class="rounded-xl w-full h-[250px] object-cover" alt="{{ p.name }}">
                    <p class="mt-3 font-semibold">{{ p.name }}</p>
                    <p class="text-gray-600">₹{{ p.price }}</p>
                </div>
            </a>
            {% endfor %}

        </div>
    </div>

    <!-- Live Filtering -->
    <script>
        const searchInput = document.getElementById("searchInput");
        const productList = document.getElementById("productList");

        searchInput.addEventListener("input", () => {
            let value = searchInput.value.toLowerCase();

            document.querySelectorAll("#productList  a").forEach(card => {
                let title = card.querySelector("p").innerText.toLowerCase();

                card.style.display = title.includes(value) ? "block" : "none";
            });
        });

        const suggestionsBox = document.getElementById("suggestions");

        // Product List from Flask
        const products = [
            {% for p in products %}
        {
            name: "{{ p.name }}",
            image: "{{ p.image_url }}",
            price: "{{ p.price }}",
            id: {{ p.id }}
        },
        {% endfor %}
        ];

        // ------------------ LIVE SUGGESTIONS ------------------
        searchInput.addEventListener("input", () => {
            let value = searchInput.value.toLowerCase();

            if (value.trim() === "") {
                suggestionsBox.classList.add("hidden");
                return;
            }

            let matched = products.filter(p => p.name.toLowerCase().includes(value));

            if (matched.length === 0) {
                suggestionsBox.classList.add("hidden");
                return;
            }

            suggestionsBox.innerHTML = matched.map(p => `
    <div class="flex items-center gap-4 p-3 hover:bg-gray-100 cursor-pointer"
         onclick="window.location.href='/product/${p.id}'">

        <img src="${p.image}" class="w-12 h-12 rounded-lg object-cover">

        <div>
            <p class="font-semibold">${p.name}</p>
            <p class="text-sm text-gray-500">₹${p.price}</p>
        </div>
    </div>
`).join("");


            suggestionsBox.classList.remove("hidden");
        });

        // Hide suggestions when clicking outside
        document.addEventListener("click", (e) => {
            if (!searchInput.contains(e.target)) {
                suggestionsBox.classList.add("hidden");
            }
        });

    </script>

</body>

</html>